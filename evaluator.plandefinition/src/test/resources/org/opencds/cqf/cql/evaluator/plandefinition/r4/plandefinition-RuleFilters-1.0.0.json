{
    "resourceType": "PlanDefinition",
    "id": "plandefinition-RuleFilters-1.0.0",
    "meta": {
      "versionId": "18",
      "lastUpdated": "2020-12-03T07:29:41.456+00:00",
      "source": "#1Vdult52UApiUgPS",
      "profile": [
        "http://hl7.org/fhir/us/ecr/StructureDefinition/ersd-plandefinition"
      ]
    },
    "text": {
      "status": "generated",
      "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\">\n            <p>\n                <b>PlanDefinition eRSD Instance</b>\n            </p>\n            <p>\n                <b>url</b>:\n\n\n\n                \n                <a href=\"PlanDefinition-plandefinition-ersd-instance.html\">http://hl7.org/fhir/us/ecr/PlanDefinition/plandefinition-ersd-instance</a>\n            </p>\n            <p>\n                <b>version</b>: 3.0.0\n\n\n\n            \n            </p>\n            <p>\n                <b>name</b>: PlanDefinition_eRSD_Instance\n\n\n\n            \n            </p>\n            <p>\n                <b>title</b>: eRSD PlanDefinition Instance\n\n\n\n            \n            </p>\n            <p>\n                <b>type</b>:\n\n\n\n                \n                <span title=\"Codes: {http://terminology.hl7.org/CodeSystem/plan-definition-type workflow-definition}\">Workflow\n        Definition</span>\n            </p>\n            <p>\n                <b>status</b>: active\n\n\n\n            \n            </p>\n            <p>\n                <b>experimental</b>: true\n\n\n\n            \n            </p>\n            <p>\n                <b>date</b>: Jul 31, 2020, 5:32:29 PM\n\n\n\n            \n            </p>\n            <p>\n                <b>publisher</b>: HL7 Public Health Work Group (http://www.hl7.org/Special/committees/pher/index.cfm)\n\n\n\n            \n            </p>\n            <p>\n                <b>contact</b>: HL7 International - Public Health:\n\n\n\n                \n                <a href=\"http://www.hl7.org/Special/committees/pher\">http://www.hl7.org/Special/committees/pher</a>\n            </p>\n            <p>\n                <b>description</b>: An example ersd PlanDefinition\n\n\n\n            \n            </p>\n            <p>\n                <b>jurisdiction</b>:\n\n\n\n                \n                <span title=\"Codes: {urn:iso:std:iso:3166 US}\">United States of America</span>\n            </p>\n            <p>\n                <b>effectivePeriod</b>: 2020-12-01 --&gt; (ongoing)\n\n\n\n            \n            </p>\n        </div>"
    },
    "url": "http://hl7.org/fhir/us/ecr/PlanDefinition/plandefinition-RuleFilters-1.0.0",
    "version": "1.1.0",
    "name": "PlanDefinition_eRSD_Instance",
    "title": "eRSD PlanDefinition Instance",
    "type": {
      "coding": [
        {
          "system": "http://terminology.hl7.org/CodeSystem/plan-definition-type",
          "code": "workflow-definition",
          "display": "Workflow Definition"
        }
      ]
    },
    "status": "active",
    "experimental": true,
    "date": "2020-07-31T12:32:29.858-05:00",
    "publisher": "HL7 Public Health Work Group (http://www.hl7.org/Special/committees/pher/index.cfm)",
    "contact": [
      {
        "name": "HL7 International - Public Health",
        "telecom": [
          {
            "system": "url",
            "value": "http://www.hl7.org/Special/committees/pher"
          }
        ]
      }
    ],
    "description": "An example ersd PlanDefinition",
    "jurisdiction": [
      {
        "coding": [
          {
            "system": "urn:iso:std:iso:3166",
            "code": "US",
            "display": "United States of America"
          }
        ],
        "text": "United States of America"
      }
    ],
    "effectivePeriod": {
      "start": "2020-12-01"
    },
    "relatedArtifact": [
      {
        "type": "depends-on",
        "label": "RCTC Value Set Library of Trigger Codes",
        "resource": "http://hl7.org/fhir/us/ecr/Library/library-rctc"
      }
    ],
    "action": [
      {
        "id": "start",
        "description": "This action represents the start of the reporting workflow in response to the encounter-start event",
        "textEquivalent": "Start the reporting workflow in response to an encounter-start event",
        "code": [
          {
            "coding": [
              {
                "system": "http://hl7.org/fhir/us/ecr/CodeSystem/executabletask-type",
                "code": "start"
              }
            ]
          }
        ],
        "definitionCanonical": "http://hl7.org/fhir/us/ecr/ActivityDefinition/activitydefinition-start",
        "trigger": [
          {
            "id": "encounter",
            "type": "named-event",
            "name": "encounter-start"
          }
        ],
        "relatedAction": [
          {
            "actionId": "check-reportable",
            "relationship": "before-start",
            "offsetDuration": {
              "value": 1,
              "system": "http://unitsofmeasure.org",
              "code": "h"
            }
          }
        ]
      },
      {
        "id": "check-reportable",
        "description": "This action represents the check for suspected reportability of the eICR.",
        "textEquivalent": "Check Reportable",
        "code": [
          {
            "coding": [
              {
                "system": "http://hl7.org/fhir/us/ecr/CodeSystem/executabletask-type",
                "code": "check-reportable"
              }
            ]
          }
        ],
        "definitionCanonical": "http://hl7.org/fhir/us/ecr/ActivityDefinition/activitydefinition-check-reportable",
        "action": [
          {
            "id": "ckr-is-encounter-reportable",
            "condition": [
              {
                "kind": "applicability",
                "expression": {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-alternativeExpression",
                      "valueExpression": {
                        "language": "text/cql-identifier",
                        "expression": "Is Reportable",
                        "reference": "http://aphl.org/fhir/ecr/Library/RuleFilters|1.0.0"
                      }
                    }
                  ],
                  "language": "text/fhirpath",
                  "expression": "%conditions.exists() or %encounters.exists() or %immunizations.exists() or %procedures.exists() or %procedureOrders.exists() or %labOrders.exists() or %labTests.exists() or %labResults.exists() or %medicationAdministrations.exists() or %medicationOrders.exists() or %medicationDispenses.exists()"
                }
              }
            ],
            "definitionCanonical": "http://hl7.org/fhir/us/ecr/ActivityDefinition/activitydefinition-ckr-is-encounter-reportable",
            "input": [
              {
                "id": "conditions",
                "type": "Condition",
                "codeFilter": [
                  {
                    "path": "code",
                    "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-dxtc-example"
                  }
                ]
              },
              {
                "id": "encounters",
                "type": "Encounter",
                "codeFilter": [
                  {
                    "path": "reasonCode",
                    "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-dxtc-example"
                  }
                ]
              },
              {
                "id": "immunizations",
                "type": "Immunization",
                "codeFilter": [
                  {
                    "path": "vaccineCode",
                    "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-mrtc-example"
                  }
                ]
              },
              {
                "id": "labOrders",
                "type": "ServiceRequest",
                "codeFilter": [
                  {
                    "path": "code",
                    "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-lotc-example"
                  }
                ]
              },
              {
                "id": "labTests",
                "type": "Observation",
                "codeFilter": [
                  {
                    "path": "code",
                    "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-lotc-example"
                  }
                ]
              },
              {
                "id": "procedureOrders",
                "type": "ServiceRequest",
                "codeFilter": [
                  {
                    "path": "code",
                    "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-pctc-example"
                  }
                ]
              },
              {
                "id": "procedures",
                "type": "Procedure",
                "codeFilter": [
                  {
                    "path": "code",
                    "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-pctc-example"
                  }
                ]
              },
              {
                "id": "medicationOrders",
                "type": "MedicationRequest",
                "codeFilter": [
                  {
                    "path": "medication",
                    "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-mrtc-example"
                  }
                ]
              },
              {
                "id": "medicationDispenses",
                "type": "MedicationDispense",
                "codeFilter": [
                  {
                    "path": "medication",
                    "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-mrtc-example"
                  }
                ]
              },
              {
                "id": "medicationAdministrations",
                "type": "MedicationAdministration",
                "codeFilter": [
                  {
                    "path": "medication",
                    "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-mrtc-example"
                  }
                ]
              },
              {
                "id": "labResults",
                "type": "Observation",
                "codeFilter": [
                  {
                    "path": "value",
                    "valueSet": "http://hl7.org/fhir/us/ecr/ValueSet/valueset-ostc-example"
                  }
                ]
              }
            ],
            "relatedAction": [
              {
                "actionId": "create-and-report-eicr",
                "relationship": "before-start"
              }
            ]
          },
          {
            "id": "ckr-is-encounter-in-progress",
            "condition": [
              {
                "kind": "applicability",
                "expression": {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-alternativeExpression",
                      "valueExpression": {
                        "language": "text/cql-identifier",
                        "expression": "Is Encounter In Progress",
                        "reference": "http://aphl.org/fhir/ecr/Library/RuleFilters|1.0.0"
                      }
                    }
                  ],
                  "language": "text/fhirpath",
                  "expression": "%encounter.status = 'in-progress'"
                }
              }
            ],
            "definitionCanonical": "http://hl7.org/fhir/us/ecr/ActivityDefinition/activitydefinition-ckr-is-encounter-in-progress",
            "relatedAction": [
              {
                "actionId": "check-reportable",
                "relationship": "before-start",
                "offsetDuration": {
                  "value": 6,
                  "system": "http://unitsofmeasure.org",
                  "code": "h"
                }
              }
            ]
          }
        ]
      },
      {
        "id": "create-and-report-eicr",
        "description": "This action represents the creation and reporting of the eICR.",
        "textEquivalent": "Create and Report eICR",
        "code": [
          {
            "coding": [
              {
                "system": "http://hl7.org/fhir/us/ecr/CodeSystem/executabletask-type",
                "code": "create-and-report-eicr"
              }
            ]
          }
        ],
        "definitionCanonical": "http://hl7.org/fhir/us/ecr/ActivityDefinition/activitydefinition-create-and-report-eicr",
        "action": [
          {
            "id": "car-report-eicr",
            "relatedAction": [
              {
                "actionId": "report-eicr",
                "relationship": "before-start"
              }
            ],
            "definitionCanonical": "http://hl7.org/fhir/us/ecr/ActivityDefinition/activitydefinition-car-report-eicr"
          },
          {
            "id": "car-is-encounter-complete",
            "condition": [
              {
                "kind": "applicability",
                "expression": {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-alternativeExpression",
                      "valueExpression": {
                        "language": "text/cql-identifier",
                        "expression": "Is Encounter Complete",
                        "reference": "http://aphl.org/fhir/ecr/Library/RuleFilters|1.0.0"
                      }
                    }
                  ],
                  "language": "text/fhirpath",
                  "expression": "%encounter.status = 'finished'"
                }
              }
            ],
            "definitionCanonical": "http://hl7.org/fhir/us/ecr/ActivityDefinition/activitydefinition-car-is-encounter-complete",
            "relatedAction": [
              {
                "actionId": "report-eicr",
                "relationship": "before-start",
                "offsetDuration": {
                  "value": 24,
                  "system": "http://unitsofmeasure.org",
                  "code": "h"
                }
              }
            ]
          },
          {
            "id": "car-is-encounter-in-progress",
            "condition": [
              {
                "kind": "applicability",
                "expression": {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-alternativeExpression",
                      "valueExpression": {
                        "language": "text/cql-identifier",
                        "expression": "Is Encounter In Progress",
                        "reference": "http://aphl.org/fhir/ecr/Library/RuleFilters|1.0.0"
                      }
                    }
                  ],
                  "language": "text/fhirpath",
                  "expression": "%encounter.status = 'in-progress'"
                }
              }
            ],
            "definitionCanonical": "http://hl7.org/fhir/us/ecr/ActivityDefinition/activitydefinition-car-is-encounter-in-progress",
            "relatedAction": [
              {
                "actionId": "create-and-report-eicr",
                "relationship": "before-start",
                "offsetDuration": {
                  "value": 24,
                  "system": "http://unitsofmeasure.org",
                  "code": "h"
                }
              }
            ]
          }
        ]
      },
      {
        "id": "report-eicr",
        "description": "This action represents the reporting of the eICR.",
        "textEquivalent": "Report eICR",
        "action": [
          {
            "id": "create-eicr",
            "description": "This action represents the creation of the eICR.",
            "textEquivalent": "Create eICR.",
            "code": [
              {
                "coding": [
                  {
                    "system": "http://hl7.org/fhir/us/ecr/CodeSystem/executabletask-type",
                    "code": "create-eicr"
                  }
                ]
              }
            ],
            "definitionCanonical": "http://hl7.org/fhir/us/ecr/ActivityDefinition/activitydefinition-create-eicr",
            "relatedAction": [
              {
                "actionId": "validate-eicr",
                "relationship": "before-start"
              }
            ]
          },
          {
            "id": "validate-eicr",
            "description": "This action represents the validation of the eICR.",
            "textEquivalent": "Validate eICR.",
            "code": [
              {
                "coding": [
                  {
                    "system": "http://hl7.org/fhir/us/ecr/CodeSystem/executabletask-type",
                    "code": "validate-eicr"
                  }
                ]
              }
            ],
            "definitionCanonical": "http://hl7.org/fhir/us/ecr/ActivityDefinition/activitydefinition-validate-eicr",
            "relatedAction": [
              {
                "actionId": "route-and-send-eicr",
                "relationship": "before-start"
              }
            ]
          },
          {
            "id": "route-and-send-eicr",
            "description": "This action represents the routing and sending of the eICR.",
            "textEquivalent": "Route and send eICR",
            "code": [
              {
                "coding": [
                  {
                    "system": "http://hl7.org/fhir/us/ecr/CodeSystem/executabletask-type",
                    "code": "route-and-send-eicr"
                  }
                ]
              }
            ],
            "definitionCanonical": "http://hl7.org/fhir/us/ecr/ActivityDefinition/activitydefinition-route-and-send-eicr"
          }
        ]
      }
    ]
  }